# 讯极日历 (SynJi AI Calendar) 全面接口技术文档 (v1.7)

## 1. 基础约定

### 1.1 通用响应格式 (ApiResponse)
所有接口均返回标准 JSON 结构，确保前端能统一解析。
```json
{
  "code": 200,       // 200-成功, 400-参数错误, 401-未授权, 500-服务器异常
  "message": "success", 
  "data": null       // 业务数据，失败时为 null
}
```

### 1.2 数据格式规范
- **日期**: `yyyy-MM-dd` (如: `2024-05-20`)
- **时间**: `HH:mm:ss` (如: `14:30:00`)
- **鉴权**: Header 携带 `Authorization: <Token>` (登录/发验证码接口除外)

---

## 2. 认证与用户模块 (Auth & User)

### 2.1 验证码登录流程
1. **发码**: `POST /api/auth/send-code` -> `{ "phoneNumber": "..." }`
2. **登录**: `POST /api/auth/login` -> 返回 Token 和用户信息。
   - **后端要求**: 用户首次登录应自动注册，并生成默认昵称。

### 2.2 获取/更新用户信息
- **获取**: `GET /api/user/info`
- **更新**: `PUT /api/user/update` -> `{ "nickname": "..." }`
   - **后端要求**: 数据库需持久化存储 `nickname` 变更。

---

## 3. 群组功能 (Group)

### 3.1 核心接口
- **列表**: `GET /api/group/list` -> 返回当前用户加入的所有群组信息。
- **创建**: `POST /api/group/create` -> `{ "name": "..." }`
   - **后端逻辑**: 随机生成 6 位唯一 `inviteCode` (如: XZ8899)，并将创建者加入群组成员。
- **加入**: `POST /api/group/join` -> `{ "inviteCode": "..." }`
   - **后端逻辑**: 根据邀请码查找群组，并将当前用户加入该群组。

---

## 4. 日程管理模块 (Schedule) - **共享逻辑核心**

### 4.1 核心字段说明 (Schedule)
| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| id | Long | 数据库自增 ID |
| title | String | 必填，日程名称 |
| belonging | String | **归属**: "个人" 或 **群组名称/ID** |
| isAiGenerated| Boolean | AI 自动生成的日程传 true，手动添加传 false |
| isViewed | Boolean | AI 生成初始为 false，用户查看后传 true |
| createdAt | String | 格式 `yyyy-MM-dd HH:mm:ss` |

### 4.2 共享日程查询逻辑 (关键)
**`GET /api/schedule/list` 接口后端逻辑变更：**
- **个人日程**: 返回该用户创建的所有 `belonging = "个人"` 的日程。
- **群组日程 (共享)**: 
  1. 查询该用户所属的所有群组 ID。
  2. 检索这些群组内**所有成员**创建的、且 `belonging` 指向对应群组的日程。
  3. 将上述日程合并后返回。
- **预期效果**: 群组 A 的成员 A1 创建了一个归属为“群组 A”的日程，成员 A2 在调用 list 接口时也能查看到该日程。

### 4.3 AI 解析逻辑 (`/api/schedule/ai-parse`)
- **逻辑**: 接收一段文本，后端通过大模型解析出日程信息，返回数组。
- **注意**: 此接口不执行存储，仅返回解析结果，由前端调用 `add` 接口入库。

---

## 5. 前后端对接测试要点 (后端必看)

1. **共享同步测试**: 
   - 用户 A 创建一个归属于“XX项目组”的日程。
   - 用户 B（同在该组）刷新日历，必须能看到该日程。
2. **红点逻辑**: 
   - 使用 AI 功能解析并添加日程 (`isAiGenerated=true, isViewed=false`)。
   - 客户端菜单显示红点。
   - 用户查看详情后，前端调用 `update` 接口将 `isViewed` 改为 `true`。后端必须保存此状态。
3. **时区与格式**:
   - 确保后端返回的 JSON 中，日期时间字符串严格遵循 `yyyy-MM-dd` 和 `HH:mm:ss`。
4. **服务器部署**:
   - 当前客户端连接 IP 为 `192.168.43.227`，端口 `8080`。请确保后端服务在此地址运行，并开启跨域支持（CORS）。
